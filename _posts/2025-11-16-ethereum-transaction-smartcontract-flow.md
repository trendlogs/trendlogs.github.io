---
id: 201
title: '트랜잭션 한 번이 스마트컨트랙트를 호출할 때 실제로 일어나는 일'
date: '2025-11-16T15:44:00+00:00'
author: '김 윤호'
layout: post
guid: 'https://trendlogs.net/?p=201'
permalink: /ethereum-transaction-smartcontract-flow/
categories:
    - 금융
    - 암호화폐
---

## 트랜잭션 생성과 지갑의 역할

트랜잭션은 Ethereum에서 발생하는 모든 활동의 출발점이며, 스마트컨트랙트 호출 역시 이 과정을 통해 시작된다. 사용자는 단순한 버튼 클릭만 경험하지만, 지갑 내부에서는 EOA의 개인키를 이용한 서명 생성 과정이 수행된다. 이 서명은 트랜잭션이 실제 소유자에 의해 발행되었음을 증명하며, 이후 네트워크로 전송될 준비가 완료된다.

## 네트워크 전파와 노드 검증

서명된 트랜잭션은 네트워크 전반으로 전파되며, 각 노드는 해당 데이터의 구조·서명·논리적 유효성을 검증한다. 검증을 통과한 트랜잭션은 밸리데이터(또는 채굴자)가 선택할 수 있도록 대기풀(mempool)에 적재된다. 이 단계는 네트워크 전체가 동일한 규칙에 따라 검증을 수행함으로써 무결성을 보장하는 절차로 구성된다.

## 블록 생성자의 선택과 수수료 구조

블록 생성자는 mempool에 있는 수많은 트랜잭션 중 수익성이 높은 항목을 우선적으로 선택한다. 가스 가격, 가스 한도, 블록 가스 한도 등의 요소가 선택 기준으로 작용한다. 이 과정은 블록 생산자가 효율적인 블록 구성을 통해 보상을 극대화하려는 구조와 직결된다.

## EVM 실행과 상태 변경

블록에 포함된 트랜잭션은 EVM(Ethereum Virtual Machine)에 의해 실행된다. EVM은 스마트컨트랙트 바이트코드를 해석하며, 스택·메모리·스토리지 같은 내부 구조를 단계적으로 변경한다. 이때 연산마다 가스가 차감되며, 로직의 복잡도와 상태 변경 정도에 따라 비용이 크게 달라진다.

## 머클 패트리샤 트리와 상태 루트

트랜잭션 실행 후 변경된 모든 상태는 머클 패트리샤 트리 구조에 기록된다. 이 데이터는 최종적으로 블록 헤더의 상태 루트(State Root)로 표현되어 네트워크 참여자 전체가 동일한 상태를 공유하도록 한다. 이 구조 덕분에 변경 내역은 조작이 불가능한 형태로 유지된다.

## 전체 과정의 의미

트랜잭션 생성부터 상태 루트가 확정되기까지의 절차는 서로 긴밀히 연결되어 있다. 이 과정을 이해하면 디앱이 서버 없이도 동작하는 이유, 블록 생성 과정의 중요성, 내가 보낸 트랜잭션이 완료되기까지 필요한 검증 절차가 무엇인지 체계적으로 이해할 수 있다. 단순한 버튼 클릭이 네트워크 전체에 반영되어 영구 기록으로 남는 흐름 자체가 Ethereum의 핵심 개념을 구성한다.

---

## 트랜잭션 생성과 지갑의 역할

트랜잭션은 Ethereum에서 발생하는 모든 활동의 출발점이며, 스마트컨트랙트 호출 역시 이 과정을 통해 시작된다. 사용자는 단순한 버튼 클릭만 경험하지만, 지갑 내부에서는 EOA의 개인키를 이용한 서명 생성 과정이 수행된다. 이 서명은 트랜잭션이 실제 소유자에 의해 발행되었음을 증명하며, 이후 네트워크로 전송될 준비가 완료된다.

## 네트워크 전파와 노드 검증

서명된 트랜잭션은 네트워크 전반으로 전파되며, 각 노드는 해당 데이터의 구조·서명·논리적 유효성을 검증한다. 검증을 통과한 트랜잭션은 밸리데이터(또는 채굴자)가 선택할 수 있도록 대기풀(mempool)에 적재된다. 이 단계는 네트워크 전체가 동일한 규칙에 따라 검증을 수행함으로써 무결성을 보장하는 절차로 구성된다.

## 블록 생성자의 선택과 수수료 구조

블록 생성자는 mempool에 있는 수많은 트랜잭션 중 수익성이 높은 항목을 우선적으로 선택한다. 가스 가격, 가스 한도, 블록 가스 한도 등의 요소가 선택 기준으로 작용한다. 이 과정은 블록 생산자가 효율적인 블록 구성을 통해 보상을 극대화하려는 구조와 직결된다.

## EVM 실행과 상태 변경

블록에 포함된 트랜잭션은 EVM(Ethereum Virtual Machine)에 의해 실행된다. EVM은 스마트컨트랙트 바이트코드를 해석하며, 스택·메모리·스토리지 같은 내부 구조를 단계적으로 변경한다. 이때 연산마다 가스가 차감되며, 로직의 복잡도와 상태 변경 정도에 따라 비용이 크게 달라진다.

## 머클 패트리샤 트리와 상태 루트

트랜잭션 실행 후 변경된 모든 상태는 머클 패트리샤 트리 구조에 기록된다. 이 데이터는 최종적으로 블록 헤더의 상태 루트(State Root)로 표현되어 네트워크 참여자 전체가 동일한 상태를 공유하도록 한다. 이 구조 덕분에 변경 내역은 조작이 불가능한 형태로 유지된다.

## 전체 과정의 의미

트랜잭션 생성부터 상태 루트가 확정되기까지의 절차는 서로 긴밀히 연결되어 있다. 이 과정을 이해하면 디앱이 서버 없이도 동작하는 이유, 블록 생성 과정의 중요성, 내가 보낸 트랜잭션이 완료되기까지 필요한 검증 절차가 무엇인지 체계적으로 이해할 수 있다. 단순한 버튼 클릭이 네트워크 전체에 반영되어 영구 기록으로 남는 흐름 자체가 Ethereum의 핵심 개념을 구성한다.

### **1. 트랜잭션의 기초 구조**

Ethereum에서 트랜잭션은 상태를 변경하는 유일한 방법이며, 계정 간 자산 전송부터 스마트컨트랙트 호출까지 모두 트랜잭션을 통해 이루어진다. 트랜잭션 객체는 보낸 주소, 받는 주소, 전송 값, 데이터 필드, 가스 한도, 가스 가격, nonce 등으로 구성되며 이러한 요소는 네트워크가 트랜잭션을 처리하는 데 필요한 모든 정보를 담는다. 개인 지갑은 이 요소들을 조합해 RLP 기반 직렬화를 진행하고, 마지막으로 개인키로 서명하여 트랜잭션의 진정성을 보장한다. 이 서명은 개인정보를 포함하지 않으면서도 암호학적 검증 구조를 통해 트랜잭션의 유효성을 나타낸다.

### **2. 지갑에서 네트워크 제출까지**

스마트컨트랙트 함수를 호출할 때 지갑은 먼저 호출하려는 함수의 식별자와 인자를 ABI 규격에 맞춰 인코딩하여 데이터 필드에 담는다. 이후 사용자의 nonce를 확인하여 트랜잭션 순서를 정하고, 가스 한도 및 수수료 설정을 마친 후 개인키로 서명한다. 서명이 완료되면 지갑은 트랜잭션을 Ethereum 네트워크에 브로드캐스트하며 여러 노드가 이를 수신하게 된다. 각 노드는 서명이 올바른지, 잔액이 충분한지, nonce가 맞는지를 검사한다.

### **3. 대기풀(Mempool)과 블록 포함**

검증이 끝나면 트랜잭션은 대기풀에 진입한다. 대기풀은 제출되었지만 아직 블록에 포함되지 않은 트랜잭션 목록이며, 노드마다 서로 다른 대기풀을 유지하나 지속적인 네트워크 전파를 통해 어느 정도 동기화된다. 검증자는 대기풀에서 우선순위가 높은 트랜잭션을 선택한다. 주로 높은 가스 가격을 제시한 트랜잭션이 먼저 선택되며, 이는 검증자의 보상 구조와 연결되어 있다. 선택된 트랜잭션은 새로운 블록에 포함되어 네트워크로 다시 전파된다.

### **4. EVM 실행과 스마트컨트랙트 내부 처리**

블록에 포함된 각 트랜잭션은 Ethereum Virtual Machine에서 실행된다. EVM은 스택 기반 가상 머신이며 스택·메모리·스토리지를 조합해 스마트컨트랙트 로직을 수행한다. 데이터 필드의 첫 4바이트는 함수 식별자, 이후는 인자 값이며 EVM은 이를 읽어 바이트코드를 해석한다. 명령어 실행은 가스를 소모하며 이러한 가스 비용 구조가 네트워크 운영과 보안에 중요한 역할을 한다.

### **5. 가스 소비와 오류 처리 및 상태 변경**

트랜잭션 실행 중 가스가 부족하면 실행이 중단되고 상태는 롤백된다. 이미 소모된 가스는 환불되지 않는다. 가스가 충분하면 스마트컨트랙트의 로직이 정상적으로 끝까지 실행되며 스토리지가 변경된다. 상태 변경은 머클 패트리샤 트리 구조를 통해 블록 헤더의 상태 루트로 요약된다. 또한 이벤트 로그는 상태값은 바꾸지 않으면서 인덱싱 가능한 기록으로 남아 디앱의 데이터 조회 기능을 돕는다.

### **6. 영수증, 최종 기록 및 확정 과정**

트랜잭션이 블록에 포함되면 트랜잭션 해시를 통해 상태를 조회할 수 있다. 이후 일정 수의 블록이 뒤따르면 해당 블록은 되돌리기 어렵게 확정된다. 스마트컨트랙트 호출의 결과는 트랜잭션 영수증에 기록되며 가스비, 로그, 실행 결과를 확인할 수 있다.

### **7. 디앱과 스마트컨트랙트 호출 흐름 요약**

디앱에서 버튼을 누르면 지갑이 트랜잭션을 생성하고 서명한다. 이 트랜잭션은 네트워크에 전파되고 대기풀에 저장된다. 선택된 트랜잭션은 블록에 포함되고 EVM이 스마트컨트랙트를 실행한다. 그 결과는 블록체인에 기록되어 디앱과 사용자가 신뢰할 수 있는 상태로 유지된다.

---

## **마무리**

사용자가 지갑에서 트랜잭션을 전송하면 서명된 데이터가 네트워크 전체로 전파되어 여러 노드에서 검증과 대기풀 저장 과정을 거친다. 검증자는 여러 트랜잭션 중 적절한 우선순위를 가진 데이터를 선택하여 블록을 구성하고, 그 블록은 다시 네트워크 전반으로 전송되어 체인에 연결된다. 이후 EVM이 트랜잭션의 스마트컨트랙트 로직을 해석·수행하며 상태를 변경하고, 이러한 결과는 영구적으로 블록에 기록된다. 이 흐름은 탈중앙화 환경에서 일관성과 안정성을 유지하는 구조적 기반이다.

**3줄 요약**

1. 트랜잭션은 지갑 서명 → 네트워크 전파 → 블록 포함 → EVM 실행 순서로 처리된다.
2. EVM은 바이트코드를 실행해 스택·스토리지 구조를 변경하며 가스를 소모한다.
3. 최종 결과는 블록에 저장되어 되돌릴 수 없는 상태로 확정된다.

---